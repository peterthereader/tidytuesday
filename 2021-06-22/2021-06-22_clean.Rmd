---
title: "Tidy Tuesday, 2021 week 26, Parks"
author: "Peter Boss"
date: "6/22/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This is the clean version of the document.  It just includes the final version, without the work-through stuff.  It should work immediately and straight through, and all the object names should be clear.  (hooray is a semi-exception that I will stand by.)  


Original website: https://github.com/rfordatascience/tidytuesday/blob/master/data/2021/2021-06-22/readme.md  

---  

OBJECTIVES  
* make a plot  
* find a simple story to tell  
* tell that story in a plot  
* find a more interesting story to tell via a plot  
* post something on twitter  


---  

```{r}
library(tidytuesdayR)
library(tidyverse)
library(janitor)
library(ggbump)
library(reshape2)


```


```{r}
# load data
tuesdata <- tidytuesdayR::tt_load(2021, week = 26)
parks <- tuesdata$parks

```


Data quirk cleanup.  This is a result of poking around the data below, and is presented here without showing the investigation.  

```{r}
# replace "DC" with "D.C."  The later years use the dots, so I went with that.  
parks[which(parks$city == "Washington, DC"),]$city <- "Washington, D.C."


```


Data formatting.  

```{r}
#' borrowing code from kierisi
#' used parse_number to convert percents and dollars to numbers without the corresponding symbols
#' converted all character data to factors
#' removed the duplicate column
hooray <- parks %>% 
  mutate(pct_near_park_data = parse_number(pct_near_park_data),
         park_pct_city_data = parse_number(park_pct_city_data),
         spend_per_resident_data = parse_number(spend_per_resident_data)) %>% 
  mutate(across(where(is.character), factor)) %>%
  select(-city_dup)

```


Selecting the parts I want.  

```{r}
#' filter down to the things we want, from either side
hoo12 <- hooray %>% filter(year == 2012)
hoo20 <- hooray %>% filter(year == 2020)
#' just keep the stuff that's in both
all_years <- hooray %>% filter(city %in% hoo12$city & city %in% hoo20$city)

#' create mini-df's for a join
all12 <- all_years %>% filter(year == 2012) %>% select(city, total_points)
all20 <- all_years %>% filter(year == 2020) %>% select(city, total_points)
#' join to get the values I want
all_out <- left_join(all12, all20, by = "city")
#' clean up the names
names(all_out)[c(2, 3)] <- c("points_2012", "points_2020")

```


These small chunks grab just the cities of interest.  

```{r}
#' this creates the category that I want, sorts, and filters for top/bottom 10
best_10 <- all_out %>%
  mutate(points_diff = all_out$points_2020 - all_out$points_2012) %>%
  arrange(desc(points_diff)) %>%
  top_n(10, points_diff)

#' this creates the category that I want, sorts, and filters for top/bottom 10
worst_10 <- all_out %>%
  mutate(points_diff = all_out$points_2020 - all_out$points_2012) %>%
  arrange(desc(points_diff)) %>%
  top_n(-10, points_diff)

#' these next two are to get a combined plot
#' choosing top/bottom 5 so there are 10 total, and then I can use my fav color scheme (also 10 things is about the limit of interpretability)  
#' this creates the category that I want, sorts, and filters for top/bottom 5
best_5 <- all_out %>%
  mutate(points_diff = all_out$points_2020 - all_out$points_2012) %>%
  arrange(desc(points_diff)) %>%
  top_n(5, points_diff)
#' this creates the category that I want, sorts, and filters for top/bottom 5
worst_5 <- all_out %>%
  mutate(points_diff = all_out$points_2020 - all_out$points_2012) %>%
  arrange(desc(points_diff)) %>%
  top_n(-5, points_diff)

```


Declare the plots, then display them.  

```{r}
best <- hooray %>% 
  filter(city %in% best_10$city) %>% 
  ggplot(aes(x = year, y = total_points, color = city)) +
  geom_point(size = 2) + 
  geom_bump() + 
  labs(y = "total points", title = "Top 10 Cities by Change in Total Points, 2012-2020") + 
  scale_color_manual(values = c("#e41a1c", "#ff7f00", "#ffff33", "#4daf4a", "#377eb8", "#984ea3", "#f781bf", "#a65628", "#999999", "#000000"))   # this is scale_color_brewer(palette = "Set1") reordered, plus the color black

worst <- hooray %>% 
  filter(city %in% worst_10$city) %>% 
  ggplot(aes(x = year, y = total_points, color = city)) +
  geom_point(size = 2) + 
  geom_bump() + 
  labs(y = "total points", title = "Bottom 10 Cities by Change in Total Points, 2012-2020") + 
  scale_color_manual(values = c("#e41a1c", "#ff7f00", "#ffff33", "#4daf4a", "#377eb8", "#984ea3", "#f781bf", "#a65628", "#999999", "#000000"))   # this is scale_color_brewer(palette = "Set1") reordered, plus the color black

best_and_worst <- hooray %>% 
  filter(city %in% best_5$city | city %in% worst_5$city) %>% 
  ggplot(aes(x = year, y = total_points, color = city)) + 
  geom_point(size = 2) + 
  geom_bump() + 
  labs(y = "total points", title = "Top 5 and Bottom 5 Cities by Change in Total Points, 2012-2020") + 
    scale_color_manual(values = c("#e41a1c", "#ff7f00", "#ffff33", "#4daf4a", "#377eb8", "#984ea3", "#f781bf", "#a65628", "#999999", "#000000"))   # this is scale_color_brewer(palette = "Set1") reordered, plus the color black

best
worst
best_and_worst

```

